generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(uuid())
  email          String          @unique
  password       String
  name           String
  role           UserRole        @default(EVENT_ORGANIZER)
  createdById    String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  configurations Configuration[]
  refreshTokens  RefreshToken[]
  createdBy      User?           @relation("UserCreatedBy", fields: [createdById], references: [id])
  createdUsers   User[]          @relation("UserCreatedBy")

  @@index([email])
  @@index([role])
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
}

model Configuration {
  id                String   @id @default(uuid())
  name              String
  customColors      Json
  images            Json?
  layouts           Json
  sectionVisibility Json
  heroText          Json?
  aboutText         Json?
  categoriesText    Json?
  categoriesCards   Json?
  timelineText      Json?
  timelineCards     Json?
  prizesText        Json?
  juryText          Json?
  documentationText Json?
  instagramText     Json?
  sponsorsText      Json?
  contactText       Json?
  faqCards          Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  slug              String   @unique
  ownerId           String?
  configType        ConfigType @default(NEUTRAL)
  owner             User?    @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([name])
  @@index([slug])
  @@index([ownerId])
}

enum ConfigType {
  DEMO
  PROD
  NEUTRAL
}

enum UserRole {
  SUPERADMIN
  EVENT_ORGANIZER
  VISITOR
}
